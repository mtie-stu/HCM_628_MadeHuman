@model Madehuman_Share.ViewModel.Shop.CreateShopOrderWithMultipleItems

@{
    ViewData["Title"] = "Tạo đơn hàng mới";
}

<h2>Tạo đơn hàng mới</h2>

<form asp-action="Create" method="post">
    <div class="form-group">
        <label>AppUserId</label>
        <input asp-for="AppUserId" class="form-control" />
    </div>

    <div class="form-group">
        <label>Trạng thái</label>
        <select asp-for="Status" class="form-control">
            @foreach (var status in Enum.GetValues(typeof(Madehuman_Share.ViewModel.Shop.StatusOrder)))
            {
                <option value="@status">@status</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label>Ngày đặt hàng</label>
        <input asp-for="OrderDate" type="datetime-local" class="form-control" />
    </div>

    <h4>Sản phẩm</h4>
    <table class="table" id="itemsTable">
        <thead>
            <tr>
                <th>Product SKU</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Items.Count; i++)
            {
                <tr>
                    <td><input name="Items[@i].ProductSKU" class="form-control" value="@Model.Items[i].ProductSKU" /></td>
                    <td><input name="Items[@i].Quantity" type="number" class="form-control" value="@Model.Items[i].Quantity" /></td>
                    <td><input name="Items[@i].UnitPrice" type="number" step="0.01" class="form-control" value="@Model.Items[i].UnitPrice" /></td>
                    <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">Xóa</button></td>
                </tr>
            }
        </tbody>
    </table>

    <button type="button" class="btn btn-secondary" onclick="addRow()">+ Thêm sản phẩm</button>
    <br /><br />
    <button type="submit" class="btn btn-primary">Tạo đơn hàng</button>
</form>

@section Scripts {
    <script>
        function addRow() {
            var table = document.getElementById("itemsTable").getElementsByTagName('tbody')[0];
            var rowCount = table.rows.length;

            var row = table.insertRow();
            row.innerHTML = `
                <td><input name="Items[${rowCount}].ProductSKU" class="form-control" /></td>
                <td><input name="Items[${rowCount}].Quantity" type="number" class="form-control" /></td>
                <td><input name="Items[${rowCount}].UnitPrice" type="number" step="0.01" class="form-control" /></td>
                <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">Xóa</button></td>
            `;
        }

        function removeRow(button) {
            var row = button.closest("tr");
            row.remove();

            // Reindex input names
            var rows = document.querySelectorAll("#itemsTable tbody tr");
            rows.forEach((tr, index) => {
                tr.querySelectorAll("input").forEach(input => {
                    if (input.name.includes("ProductSKU"))
                        input.name = `Items[${index}].ProductSKU`;
                    else if (input.name.includes("Quantity"))
                        input.name = `Items[${index}].Quantity`;
                    else if (input.name.includes("UnitPrice"))
                        input.name = `Items[${index}].UnitPrice`;
                });
            });
        }
    </script>
}
